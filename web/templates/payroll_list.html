{{template "header" .}}
<div class="page-header">
	<h1>Payroll</h1>
	<a href="/payroll/new" class="btn btn-primary">Add Payroll</a>
</div>

<form action="/payroll" method="GET" class="filter-bar">
	<div class="form-group">
		<label for="start_date">Period Start From</label>
		<input type="date" id="start_date" name="start_date" value="{{.Filter.StartDate}}">
	</div>
	<div class="form-group">
		<label for="end_date">Period End To</label>
		<input type="date" id="end_date" name="end_date" value="{{.Filter.EndDate}}">
	</div>
	<div class="form-group narrow">
		<label for="status">Status</label>
		<select id="status" name="status">
			<option value="">All</option>
			<option value="not_paid" {{if eq .Filter.Status "not_paid"}}selected{{end}}>Unpaid</option>
			<option value="paid" {{if eq .Filter.Status "paid"}}selected{{end}}>Paid</option>
		</select>
	</div>
	<div class="form-group">
		<label for="employee_id">Employee</label>
		<select id="employee_id" name="employee_id">
			<option value="">All Employees</option>
			{{range .Employees}}
			<option value="{{.ID}}" {{if eq $.Filter.EmployeeID .ID}}selected{{end}}>{{.Name}}</option>
			{{end}}
		</select>
	</div>
	<button type="submit" class="btn btn-secondary">Filter</button>
	<a href="/payroll" class="btn btn-secondary">Clear</a>
</form>

{{if .Payrolls}}
<table>
	<thead>
		<tr>
			<th>Employee</th>
			<th>Period</th>
			<th class="money hide-mobile">Hours</th>
			<th class="money hide-mobile">Rate</th>
			<th class="money">Total Pay</th>
			<th>Status</th>
			<th class="hide-mobile">Payment</th>
			<th class="actions"></th>
		</tr>
	</thead>
	<tbody>
		{{range .Payrolls}}
		<tr>
			<td>{{.EmployeeName}}</td>
			<td>{{.PeriodStart}} - {{.PeriodEnd}}</td>
			<td class="money hide-mobile">{{printf "%.1f" .TotalHours}}</td>
			<td class="money hide-mobile">${{printf "%.2f" .HourlyRate}}</td>
			<td class="money">${{printf "%.2f" .TotalPay}}</td>
			<td>
				{{if eq .Status "paid"}}
				<span class="status status-paid">Paid</span>
				{{else}}
				<span class="status status-unpaid">Unpaid</span>
				{{end}}
			</td>
			<td class="hide-mobile">{{.PaymentMethod}} {{if .CheckNumber}}#{{.CheckNumber}}{{end}}</td>
			<td class="actions">
				{{if eq .Status "not_paid"}}
				<form action="/payroll/{{.ID}}/pay" method="POST" style="display:inline">
					<button type="submit" class="btn btn-success btn-small">Mark Paid</button>
				</form>
				{{end}}
				<a href="/payroll/{{.ID}}/edit" class="btn btn-secondary btn-small">Edit</a>
			</td>
		</tr>
		{{end}}
		<tr class="totals-row">
			<td colspan="4">Total</td>
			<td class="money">${{printf "%.2f" .Total}}</td>
			<td colspan="3"></td>
		</tr>
	</tbody>
</table>
{{else}}
<p class="empty-state">No payroll records found. Add one using the button above.</p>
{{end}}
{{template "footer" .}}
