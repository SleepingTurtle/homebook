{{template "header" .}}

<div class="flex items-center justify-between mb-6">
	<h1 class="text-2xl font-semibold text-gray-900">{{if .Delivery.ID}}Edit{{else}}Add{{end}} Delivery Sales</h1>
</div>

{{if .Error}}
<div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 text-sm">{{.Error}}</div>
{{end}}

<form action="/sales/delivery" method="POST" class="space-y-6">
	<!-- Date Picker -->
	<div class="bg-white border border-gray-200 rounded-lg px-6 py-4">
		<div class="max-w-[200px]">
			<label for="date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
			<input type="date" id="date" name="date" value="{{.Delivery.Date}}" required
				class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
		</div>
	</div>

	<!-- Delivery Services Grid -->
	<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
		<!-- Grubhub -->
		<div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
			<div class="flex items-center gap-3 px-5 py-4 text-white" style="background: linear-gradient(135deg, #f63440 0%, #d42e38 100%);">
				<span class="flex items-center justify-center w-9 h-9 bg-white/20 rounded-lg">
					<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
						<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
					</svg>
				</span>
				<span class="text-lg font-semibold">Grubhub</span>
			</div>
			<div class="p-5 space-y-4">
				<div>
					<label for="grubhub_subtotal" class="block text-sm font-medium text-gray-700 mb-1">Subtotal (Gross)</label>
					<div class="flex">
						<span class="inline-flex items-center px-3 bg-gray-100 border border-r-0 border-gray-300 rounded-l-md text-gray-500 font-medium">$</span>
						<input type="number" id="grubhub_subtotal" name="grubhub_subtotal" step="0.01" min="0" value="{{if .Delivery.ID}}{{printf "%.2f" .Delivery.GrubhubSubtotal}}{{end}}" placeholder="0.00"
							class="flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-r-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
					</div>
				</div>
				<div>
					<label for="grubhub_net" class="block text-sm font-medium text-gray-700 mb-1">Net (After Fees)</label>
					<div class="flex">
						<span class="inline-flex items-center px-3 bg-gray-100 border border-r-0 border-gray-300 rounded-l-md text-gray-500 font-medium">$</span>
						<input type="number" id="grubhub_net" name="grubhub_net" step="0.01" min="0" value="{{if .Delivery.ID}}{{printf "%.2f" .Delivery.GrubhubNet}}{{end}}" placeholder="0.00"
							class="flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-r-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
					</div>
				</div>
				<div class="flex justify-between items-center pt-4 border-t border-gray-100">
					<span class="text-sm text-gray-500">Fees:</span>
					<span class="font-semibold font-mono text-red-600" id="grubhub-fee">$0.00</span>
				</div>
			</div>
		</div>

		<!-- DoorDash -->
		<div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
			<div class="flex items-center gap-3 px-5 py-4 text-white" style="background: linear-gradient(135deg, #ff3008 0%, #eb2a06 100%);">
				<span class="flex items-center justify-center w-9 h-9 bg-white/20 rounded-lg">
					<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
						<path d="M23.071 8.409a6.09 6.09 0 00-5.396-3.228H.584A.589.589 0 00.17 6.184L3.894 9.93a1.752 1.752 0 001.242.516h12.049a1.554 1.554 0 11.031 3.108H8.91a.589.589 0 00-.415 1.003l3.725 3.747a1.75 1.75 0 001.242.516h3.757c4.887 0 8.584-5.225 5.852-10.41z"/>
					</svg>
				</span>
				<span class="text-lg font-semibold">DoorDash</span>
			</div>
			<div class="p-5 space-y-4">
				<div>
					<label for="doordash_subtotal" class="block text-sm font-medium text-gray-700 mb-1">Subtotal (Gross)</label>
					<div class="flex">
						<span class="inline-flex items-center px-3 bg-gray-100 border border-r-0 border-gray-300 rounded-l-md text-gray-500 font-medium">$</span>
						<input type="number" id="doordash_subtotal" name="doordash_subtotal" step="0.01" min="0" value="{{if .Delivery.ID}}{{printf "%.2f" .Delivery.DoordashSubtotal}}{{end}}" placeholder="0.00"
							class="flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-r-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
					</div>
				</div>
				<div>
					<label for="doordash_net" class="block text-sm font-medium text-gray-700 mb-1">Net (After Fees)</label>
					<div class="flex">
						<span class="inline-flex items-center px-3 bg-gray-100 border border-r-0 border-gray-300 rounded-l-md text-gray-500 font-medium">$</span>
						<input type="number" id="doordash_net" name="doordash_net" step="0.01" min="0" value="{{if .Delivery.ID}}{{printf "%.2f" .Delivery.DoordashNet}}{{end}}" placeholder="0.00"
							class="flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-r-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
					</div>
				</div>
				<div class="flex justify-between items-center pt-4 border-t border-gray-100">
					<span class="text-sm text-gray-500">Fees:</span>
					<span class="font-semibold font-mono text-red-600" id="doordash-fee">$0.00</span>
				</div>
			</div>
		</div>

		<!-- Uber Eats -->
		<div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
			<div class="flex items-center gap-3 px-5 py-4 text-white" style="background: linear-gradient(135deg, #06c167 0%, #05a859 100%);">
				<span class="flex items-center justify-center w-9 h-9 bg-white/20 rounded-lg">
					<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
						<path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
					</svg>
				</span>
				<span class="text-lg font-semibold">Uber Eats</span>
			</div>
			<div class="p-5 space-y-4">
				<div>
					<label for="ubereats_earnings" class="block text-sm font-medium text-gray-700 mb-1">Earnings (Gross)</label>
					<div class="flex">
						<span class="inline-flex items-center px-3 bg-gray-100 border border-r-0 border-gray-300 rounded-l-md text-gray-500 font-medium">$</span>
						<input type="number" id="ubereats_earnings" name="ubereats_earnings" step="0.01" min="0" value="{{if .Delivery.ID}}{{printf "%.2f" .Delivery.UberEatsEarnings}}{{end}}" placeholder="0.00"
							class="flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-r-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
					</div>
				</div>
				<div>
					<label for="ubereats_payout" class="block text-sm font-medium text-gray-700 mb-1">Payout (Net)</label>
					<div class="flex">
						<span class="inline-flex items-center px-3 bg-gray-100 border border-r-0 border-gray-300 rounded-l-md text-gray-500 font-medium">$</span>
						<input type="number" id="ubereats_payout" name="ubereats_payout" step="0.01" min="0" value="{{if .Delivery.ID}}{{printf "%.2f" .Delivery.UberEatsPayout}}{{end}}" placeholder="0.00"
							class="flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-r-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
					</div>
				</div>
				<div class="flex justify-between items-center pt-4 border-t border-gray-100">
					<span class="text-sm text-gray-500">Fees:</span>
					<span class="font-semibold font-mono text-red-600" id="ubereats-fee">$0.00</span>
				</div>
			</div>
		</div>
	</div>

	<!-- Summary Bar -->
	<div class="flex flex-wrap items-center gap-8 lg:gap-12 bg-slate-800 rounded-lg px-6 py-5">
		<div class="flex flex-col gap-1">
			<span class="text-[11px] font-medium text-slate-400 uppercase tracking-wide">Total Gross</span>
			<span class="text-2xl font-semibold text-white font-mono" id="summary-gross">$0.00</span>
		</div>
		<div class="flex flex-col gap-1">
			<span class="text-[11px] font-medium text-slate-400 uppercase tracking-wide">Total Net</span>
			<span class="text-2xl font-semibold text-green-400 font-mono" id="summary-net">$0.00</span>
		</div>
		<div class="ml-auto flex flex-col items-end gap-1">
			<span class="text-[11px] font-medium text-slate-400 uppercase tracking-wide">Total Fees</span>
			<span class="text-2xl font-semibold text-red-400 font-mono" id="summary-fees">$0.00</span>
			<span class="text-xs text-slate-400" id="summary-fee-percent"></span>
		</div>
	</div>

	<!-- Notes -->
	<div class="bg-white border border-gray-200 rounded-lg p-6">
		<h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-4">Notes</h3>
		<textarea id="notes" name="notes" rows="2" placeholder="Any notes about today's delivery sales (optional)..."
			class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">{{.Delivery.Notes}}</textarea>
	</div>

	<!-- Actions -->
	<div class="flex flex-col sm:flex-row justify-end items-stretch sm:items-center gap-2 pt-2">
		<a href="/sales" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-50 text-center">Cancel</a>
		<button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700">Save Delivery Sales</button>
	</div>
</form>

<script>
(function() {
	// Input elements
	const grubhubSubtotal = document.getElementById('grubhub_subtotal');
	const grubhubNet = document.getElementById('grubhub_net');
	const doordashSubtotal = document.getElementById('doordash_subtotal');
	const doordashNet = document.getElementById('doordash_net');
	const ubereatsEarnings = document.getElementById('ubereats_earnings');
	const ubereatsPayout = document.getElementById('ubereats_payout');

	// Fee displays
	const grubhubFee = document.getElementById('grubhub-fee');
	const doordashFee = document.getElementById('doordash-fee');
	const ubereatsFee = document.getElementById('ubereats-fee');

	// Summary displays
	const summaryGross = document.getElementById('summary-gross');
	const summaryNet = document.getElementById('summary-net');
	const summaryFees = document.getElementById('summary-fees');
	const summaryFeePercent = document.getElementById('summary-fee-percent');

	function formatMoney(val) {
		return '$' + Math.abs(val).toFixed(2);
	}

	function updateCalculations() {
		const gh_sub = parseFloat(grubhubSubtotal.value) || 0;
		const gh_net = parseFloat(grubhubNet.value) || 0;
		const dd_sub = parseFloat(doordashSubtotal.value) || 0;
		const dd_net = parseFloat(doordashNet.value) || 0;
		const ue_earn = parseFloat(ubereatsEarnings.value) || 0;
		const ue_pay = parseFloat(ubereatsPayout.value) || 0;

		// Calculate individual fees
		const gh_fee = gh_sub - gh_net;
		const dd_fee = dd_sub - dd_net;
		const ue_fee = ue_earn - ue_pay;

		grubhubFee.textContent = formatMoney(gh_fee);
		doordashFee.textContent = formatMoney(dd_fee);
		ubereatsFee.textContent = formatMoney(ue_fee);

		// Calculate totals
		const totalGross = gh_sub + dd_sub + ue_earn;
		const totalNet = gh_net + dd_net + ue_pay;
		const totalFees = gh_fee + dd_fee + ue_fee;

		summaryGross.textContent = formatMoney(totalGross);
		summaryNet.textContent = formatMoney(totalNet);
		summaryFees.textContent = formatMoney(totalFees);

		// Calculate fee percentage
		if (totalGross > 0) {
			const feePercent = (totalFees / totalGross) * 100;
			summaryFeePercent.textContent = '(' + feePercent.toFixed(1) + '%)';
		} else {
			summaryFeePercent.textContent = '';
		}
	}

	// Add listeners to all inputs
	[grubhubSubtotal, grubhubNet, doordashSubtotal, doordashNet, ubereatsEarnings, ubereatsPayout].forEach(input => {
		input.addEventListener('input', updateCalculations);
	});

	// Initial calculation
	updateCalculations();
})();
</script>

{{template "footer" .}}
